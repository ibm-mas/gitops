---
apiVersion: core.mas.ibm.com/v1
kind: Suite
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "114"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
{{- if .Values.ibm_mas_suite.mas_annotations }}
{{ .Values.ibm_mas_suite.mas_annotations | toYaml | indent 4 }}
{{- end }}
  labels:
    mas.ibm.com/instanceId: "{{ .Values.ibm_mas_suite.mas_instance_id }}" 
{{- if .Values.ibm_mas_suite.mas_labels }}
{{ .Values.ibm_mas_suite.mas_labels | toYaml | indent 4 }}
{{- end }}
  name: "{{ .Values.ibm_mas_suite.mas_instance_id }}"
  namespace: mas-{{ .Values.ibm_mas_suite.mas_instance_id }}-core
spec:
  domain: "{{ .Values.ibm_mas_suite.domain }}"
  certManagerNamespace: {{ .Values.ibm_mas_suite.cert_manager_namespace | default "cert-manager" }}
{{- if and .Values.ibm_mas_suite.dns_provider (eq .Values.ibm_mas_suite.mas_manual_cert_mgmt false) }}
  certificateIssuer:
    duration: 8760h0m0s
    name: "{{ .Values.ibm_mas_suite.mas_instance_id }}-{{ .Values.ibm_mas_suite.dns_provider }}-le-prod" 
    renewBefore: 720h0m0s
{{ end }}
  license:
    accept: true
  settings:
    manualCertMgmt: {{ .Values.ibm_mas_suite.mas_manual_cert_mgmt | default false }}
    icr:
      cp: "{{ .Values.ibm_mas_suite.icr_cp }}"
      cpopen: "{{ .Values.ibm_mas_suite.icr_cp_open }}"
{{- if .Values.ibm_mas_suite.mas_image_tags }}
    imageTags: 
{{ .Values.ibm_mas_suite.mas_image_tags | toYaml | indent 6 }}
{{ end }}
