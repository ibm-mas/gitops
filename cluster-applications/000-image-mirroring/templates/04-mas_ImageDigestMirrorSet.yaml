---
apiVersion: config.openshift.io/v1
kind: ImageDigestMirrorSet
metadata:
  name: mas-ecr
spec:
  imageDigestMirrors:
    - mirrorSourcePolicy: NeverContactSource
      mirrors:
        - "{{ .Values.ecr_host }}/{{ .Values.repo_path_prefix }}"
      source: icr.io
    - mirrorSourcePolicy: NeverContactSource
      mirrors:
        - "{{ .Values.ecr_host }}/{{ .Values.repo_path_prefix }}"
      source: cp.icr.io
{{- if .Values.additional_image_digest_sources }}
{{- range $i, $value := .Values.additional_image_digest_sources }}
    - mirrors:
        - "{{ $.Values.ecr_host }}/{{ $.Values.repo_path_prefix }}"
        - "{{ $.Values.ecr_host }}/{{ $.Values.repo_path_prefix }}/cp"
      source: {{ $value }}
{{- end }}
{{- end }}
   