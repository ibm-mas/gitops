{{- if and (eq .Values.dns_provider "cis") (not .Values.mas_manual_cert_mgmt) }}
{{- if .Values.dro_public_domain }}
{{- $existingSecret := lookup "v1" "Secret" "ibm-software-central" "dro-client-tls" }}
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: ibm-data-reporter-public-route
  namespace: ibm-software-central
  labels:
    type: external
    route.openshift.io/destination-ca-certificate-secret: dro-server-tls

spec:
  host: "dro.{{ .Values.cluster_id }}.{{ .Values.dro_public_domain }}"
  # host: "dro.apps.noble6.cp.fyre.ibm.com"
  to:
    kind: Service
    name: ibm-data-reporter-operator-controller-manager-metrics-service
    weight: 100
  port:
    targetPort: 8443
  tls:
    termination: reencrypt
    insecureEdgeTerminationPolicy: Redirect
    {{- if $existingSecret }}
    certificate: |
      {{- index $existingSecret.data "tls.crt" | b64dec | nindent 6 }}
    key: |
      {{- index $existingSecret.data "tls.key" | b64dec | nindent 6 }}
    {{- end }}
    # name: dro-secret
    # externalCertificate:
      # name: dro-tls-secret
      # name: "dro-client-tls"
    # destinationCACertificate:
    #   name: "dro-server-tls"
  wildcardPolicy: None
{{- end }}
{{- end }}