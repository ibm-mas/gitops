{{ source_repo() }}
===============================================================================

The {{ source_repo() }} (usually [ibm-mas/gitops](https://github.com/ibm-mas/gitops)) provides Helm Charts that define all of the Kubernetes resources required to deploy MAS instances using ArgoCD. The Helm Charts are split across three sub directories, depending on their intended target:

- **{{ gitops_repo_dir_link("root-applications") }}**: these charts define ArgoCD Application and ApplicationSet templates following the [App of Apps pattern](https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/#app-of-apps-pattern) and target the {{ management_cluster() }} where ArgoCD is running. The Applications and ApplicationSets render other charts from {{ gitops_repo_dir_link("root-applications") }}, {{ gitops_repo_dir_link("cluster-applications") }} or {{ gitops_repo_dir_link("instance-applications") }}
- **{{ gitops_repo_dir_link("cluster-applications") }}**: these charts define Kubernetes resources for installing cluster-wide MAS pre-requisites on {{ target_clusters() }} where MAS is to be installed and managed.
- **{{ gitops_repo_dir_link("instance-applications") }}**: these charts define Kubernetes resources for installing and managing MAS instances on {{ target_clusters() }}.


The following figure shows a tree of ArgoCD applications and Application Sets generated by the charts under **{{ gitops_repo_dir_link("root-applications") }}**, starting with the **Account Root Application** at the top.

![Application Structure](drawio/appstructure.drawio)


#### {{ account_root_chart() }} 

**Account Root Applications** render the {{ account_root_chart() }}, which installs the {{ cluster_root_app_set() }}. This generates a set of **Cluster Root Applications** based on the configuration in the {{ config_repo() }} 


#### {{ cluster_root_chart() }} 

**Cluster Root Applications** render the {{ cluster_root_chart() }}, which contains templates to generate ArgoCD Applications for configuring various dependencies shared by MAS instances on {{ target_clusters() }}:

- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/000-ibm-operator-catalog-app.yaml", "Operator Catalog") }} {{ gitops_repo_dir_link("cluster-applications/000-ibm-operator-catalog", "(Chart)") }}
- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/010-ibm-redhat-cert-manager-app.yaml", "Redhat Certificate Manager") }} {{ gitops_repo_dir_link("cluster-applications/010-redhat-cert-manager", "(Chart)") }}
- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/020-ibm-dro-app.yaml", "DRO") }} {{ gitops_repo_dir_link("cluster-applications/020-ibm-dro", "(Chart)") }} 
- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/060-ibm-db2u-app.yaml", "Db2u Operator") }} {{ gitops_repo_dir_link("cluster-applications/060-ibm-db2u", "(Chart)") }} 
- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/040-cis-compliance-app.yaml", "CIS Compliance") }} {{ gitops_repo_dir_link("cluster-applications/040-cis-compliance", "(Chart)") }} 
- {{ gitops_repo_file_link("root-applications/ibm-mas-cluster-root/templates/050-nvidia-gpu-operator-app.yaml", "Nvidia GPU Operator") }} {{ gitops_repo_dir_link("cluster-applications/050-nvidia-gpu-operator", "(Chart)") }} 

The {{ cluster_root_chart() }} also installs the {{ instance_root_app_set() }}. This generates a set of **Instance Root Applications** based on the configuration in the {{  config_repo() }}.  

#### {{ instance_root_chart() }} 

**Instance Root Applications**  render the {{ instance_root_chart() }}, which contains templates to generate ArgoCD Applications that installs MAS on {{ target_clusters() }}, including:

- Instance-level MAS dependencies:
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/080-ibm-cp4d-app.yaml", "CP4D") }} {{ gitops_repo_dir_link("instance-applications/080-ibm-cp4d", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/100-ibm-sls-app.yaml", "SLS (Suite License Service)") }} {{ gitops_repo_dir_link("instance-applications/100-ibm-sls", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/120-db2-databases-app.yaml", "DB2 Databases") }}[^1] {{ gitops_repo_dir_link("instance-applications/120-ibm-db2u-database", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/090-ibm-wsl-app.yaml", "WSL") }} {{ gitops_repo_dir_link("instance-applications/090-ibm-wsl", "(Chart)") }}


  - MAS Core itself, including the suite, suite configurations and core workspaces:
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/130-ibm-mas-suite-app.yaml", "MAS Core Suite") }} {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-suite", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/200-ibm-mas-workspaces.yaml", "MAS Workspaces") }}[^1] {{ gitops_repo_dir_link("instance-applications/220-ibm-mas-workspace", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/130-ibm-mas-suite-configs-app.yaml", "Suite Configs") }}[^1] (Charts[^2])


  - MAS Applications (base application installs):
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/500-ibm-mas-masapp-assist-install.yaml", "MAS App Assist Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/500-ibm-mas-masapp-iot-install.yaml", "MAS App IoT Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/500-ibm-mas-masapp-manage-install.yaml", "MAS App Manage Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/500-ibm-mas-masapp-visualinspection-install.yaml", "MAS App VisualInspection Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/520-ibm-mas-masapp-health-install.yaml", "MAS App Health Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/520-ibm-mas-masapp-monitor-install.yaml", "MAS App Monitor Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/520-ibm-mas-masapp-optimizer-install.yaml", "MAS App Optimizer Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/540-ibm-mas-masapp-predict-install.yaml", "MAS App Predict Install") }} {{ gitops_repo_dir_link("instance-applications/500-540-ibm-mas-suite-app-install", "(Chart)") }}

  - MAS Applications (application workspace configurations):
    - {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/510-550-ibm-mas-masapp-configs.yaml", "MAS App Configs") }}[^1] {{ gitops_repo_dir_link("instance-applications/510-550-ibm-mas-suite-app-config", "(Generic Chart)") }}



[^1]: These templates are capable of generating multiple Applications; necessary because there may be one or more instances of the **type** of resource they are responsible for managing.
[^2]:
    The {{ gitops_repo_file_link("root-applications/ibm-mas-instance-root/templates/130-ibm-mas-suite-configs-app.yaml", "Suite Configs") }} Application is responsible for installing various types of suite configuration types (Mongo, BAS, SMTP, etc) at various scopes (`system`, `app`, `ws`, `wsapp`). The chart is chosen dynamically based on the configuration type: {{ gitops_repo_dir_link("instance-applications/130-ibm-jdbc-config", "JDBC") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-kafka-config", "Kafka") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-bas-config", "BAS") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-idp-config", "IDP") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-mongo-config", "Mongo") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-sls-config", "SLS") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-mas-smtp-config", "SMTP") }}, {{ gitops_repo_dir_link("instance-applications/130-ibm-objectstorage-config", "COS") }}

    
