{{- $namespaces := list .Values.aiservice_namespace .Values.tenantNamespace }}
{{- range $ns := $namespaces }}
---
apiVersion: v1
kind: Secret
metadata:
  name: "{{ $.Values.tenantNamespace }}----wx-secret"
  namespace: "{{ $ns }}"
  {{- with $.Values.custom_labels }}
  labels:
    {{- range $key, $val := . }}
    {{ $key | quote }}: {{ $val | quote }}
    {{- end }}
  {{- end }}
  annotations:
    argocd.argoproj.io/sync-wave: "304"
type: Opaque
data:
  wx_apikey: {{ $.Values.aiservice_watsonxai_apikey  | default "" | toString | b64enc }}
  wx_url: {{ $.Values.aiservice_watsonxai_url   | default "" | toString |  b64enc }}
  wx_project_id: {{ $.Values.aiservice_watsonxai_project_id   | default "" | toString |  b64enc }}
  wx_verify: {{ true | b64enc }}
  {{- if .Values.aiservice_watsonxai_ca_crt }}
  ca.crt: {{ $.Values.aiservice_watsonxai_ca_crt | toString | b64enc | quote }}
  {{- end }}
  {{- if and (eq $.Values.aiservice_watsonxai_on_prem "true") $.Values.aiservice_watsonxai_instance_id $.Values.aiservice_watsonxai_version $.Values.aiservice_watsonxai_username }}
  wx_instance_id: {{ $.Values.aiservice_watsonxai_instance_id | toString | b64enc | quote }}
  wx_version: {{ $.Values.aiservice_watsonxai_version | toString | b64enc | quote }}
  wx_username: {{ $.Values.aiservice_watsonxai_username | toString | b64enc | quote }}
  {{- end }}
{{- end }}
