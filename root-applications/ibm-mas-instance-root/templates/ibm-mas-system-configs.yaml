---
# IBM Maximo Operator Catalog
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: system-configs.{{.Values.account.id}}.{{.Values.region.id}}.{{ .Values.cluster.id }}.{{ .Values.instance.id }}
  namespace: openshift-gitops
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: mas
  destination:
    server: {{ .Values.cluster.url }}
    namespace: default
  sources:
    {{- if not (empty (index .Values "system-configs")) }}
    
    {{- if not (empty (index .Values "system-configs" "mongo")) }}
    - path: applications/ibm-mas-mongo-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "mongo" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "jdbc")) }}
    - path: applications/ibm-db2u-jdbc-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "jdbc" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "sls")) }}
    - path: applications/ibm-mas-sls-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "sls" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "bas")) }}
    - path: applications/ibm-mas-bas-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "bas" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "kafka")) }}
    - path: applications/ibm-kafka-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "kafka" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "idp")) }}
    - path: applications/ibm-mas-idp-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "idp" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "smtp")) }}
    - path: applications/ibm-mas-smtp-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "smtp" | toRawJson }}
    {{- end }}
    {{- if not (empty (index .Values "system-configs" "objectstorage")) }}
    - path: applications/ibm-objectstorage-config
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ index .Values "system-configs" "objectstorage" | toRawJson }}
    {{- end }}

    {{- end }} # if not (empty (index .Values "system-configs"))
    - path: applications/ibm-mas-system-config-cleanup
      repoURL: https://github.com/ibm-mas/gitops
      targetRevision: mascore1425
      plugin:
        env:
          - name: HELM_VALUES
            value: |
              {{ .Values | toRawJson }}
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
      - RespectIgnoreDifferences=true
